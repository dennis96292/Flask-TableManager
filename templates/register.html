<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ç®¡ç†å¸³è™Ÿ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #121212; color: white; }
        .container { max-width: 600px; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; }

        /* ğŸ”¹ å›ºå®šè¡¨æ ¼æ¬„é«˜ */
        th, td { 
            padding: 15px;  /* ğŸ”¹ è®“å…§å®¹æœ‰é©ç•¶é–“è· */
            text-align: center;
            border: 1px solid #444;
            height: 50px;  /* ğŸ”¹ å›ºå®šæ¬„é«˜ï¼Œé¿å…è®Šå½¢ */
            vertical-align: middle;  /* ğŸ”¹ ç¢ºä¿å…§å®¹ç½®ä¸­å°é½Š */
        }

        th { background-color: #1e1e1e; }
        .btn { margin: 5px; }
        .crown { color: gold; font-weight: bold; }
        .password-cell { cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center">å¸³è™Ÿç®¡ç†</h2>
        <table class="table table-dark table-bordered">
            <thead>
                <tr>
                    <th>å¸³è™Ÿ</th>
                    <th>å¯†ç¢¼</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="account-table"></tbody>
        </table>
        <button class="btn btn-danger" onclick="logout()">ç™»å‡º</button>
    </div>

    <script>
        function loadAccounts() {
            fetch("/api/get_accounts")
                .then(response => response.json())
                .then(data => {
                    let tableBody = document.getElementById("account-table");
                    tableBody.innerHTML = "";

                    data.forEach(account => {
                        let tr = document.createElement("tr");

                        let tdUser = document.createElement("td");
                        tdUser.textContent = account.username;
                        if (account.username === "admin") {
                            tdUser.innerHTML += ' <span class="crown">ğŸ‘‘</span>'; // admin é¡¯ç¤ºçš‡å† 
                        }

                        let tdPass = document.createElement("td");
                        tdPass.classList.add("password-cell");
                        tdPass.dataset.full = account.password;
                        tdPass.textContent = account.password.length > 10 ? account.password.slice(0, 10) + "..." : account.password;
                        tdPass.onclick = function () { togglePassword(tdPass); };

                        let tdAction = document.createElement("td");
                        if (account.username === "admin") {
                            tdAction.textContent = "ä¸å¯åˆªé™¤";
                        } else {
                            let delBtn = document.createElement("button");
                            delBtn.textContent = "åˆªé™¤";
                            delBtn.classList.add("btn", "btn-danger");
                            delBtn.onclick = function() {
                                if (confirm(`ç¢ºå®šåˆªé™¤å¸³è™Ÿ ${account.username}ï¼Ÿ`)) {
                                    deleteAccount(account.username);
                                }
                            };
                            tdAction.appendChild(delBtn);
                        }

                        tr.appendChild(tdUser);
                        tr.appendChild(tdPass);
                        tr.appendChild(tdAction);
                        tableBody.appendChild(tr);
                    });

                    // æ–°å¢å¸³è™Ÿçš„è¼¸å…¥è¡Œ
                    let tr = document.createElement("tr");

                    let tdNewUser = document.createElement("td");
                    let inputUser = document.createElement("input");
                    inputUser.classList.add("form-control");
                    inputUser.setAttribute("autocomplete", "off");
                    inputUser.setAttribute("placeholder", "è¼¸å…¥å¸³è™Ÿ");
                    tdNewUser.appendChild(inputUser);

                    let tdNewPass = document.createElement("td");
                    let inputPass = document.createElement("input");
                    inputPass.type = "password";
                    inputPass.classList.add("form-control");
                    inputPass.setAttribute("autocomplete", "new-password");
                    inputPass.setAttribute("placeholder", "è¼¸å…¥å¯†ç¢¼");
                    tdNewPass.appendChild(inputPass);

                    let tdNewAction = document.createElement("td");
                    let addBtn = document.createElement("button");
                    addBtn.textContent = "æ–°å¢";
                    addBtn.classList.add("btn", "btn-success");
                    addBtn.onclick = function() {
                        addAccount(inputUser.value.trim(), inputPass.value.trim());
                    };
                    tdNewAction.appendChild(addBtn);

                    tr.appendChild(tdNewUser);
                    tr.appendChild(tdNewPass);
                    tr.appendChild(tdNewAction);
                    tableBody.appendChild(tr);
                });
        }

        function togglePassword(td) {
            if (td.dataset.fullVisible === "true") {
                td.textContent = td.dataset.full.slice(0, 10) + "..."; // åˆ‡æ›å›éƒ¨åˆ†é¡¯ç¤º
                td.dataset.fullVisible = "false";
            } else {
                td.textContent = td.dataset.full; // é¡¯ç¤ºå®Œæ•´å¯†ç¢¼
                td.dataset.fullVisible = "true";
            }
        }

        function addAccount(username, password) {
            if (!username || !password) {
                alert("å¸³è™Ÿèˆ‡å¯†ç¢¼ä¸å¯ç‚ºç©º");
                return;
            }

            fetch("/api/add_account", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username: username, password: password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("å¸³è™Ÿæ–°å¢æˆåŠŸï¼");
                    window.location.reload();
                } else {
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error("âŒ æ–°å¢å¸³è™ŸéŒ¯èª¤:", error);
                alert("ä¼ºæœå™¨ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
            });
        }

        function deleteAccount(username) {
            fetch(`/api/delete_account/${username}`, { method: "DELETE" })
                .then(() => loadAccounts());
        }

        function logout() {
            fetch('/logout').then(() => window.location.href = '/');
        }

        loadAccounts();
    </script>
</body>
</html>
